<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calificaciones</title>
    <link rel="stylesheet" href="/static/css/estilos_prof.css">
    <link rel="icon" href="static/imagenes/icono_pagina.png">
</head>
<body>
    <header>
        <h1>ALPHA TEAM</h1>
            <figure class="logo_pagina">
                <img src="/static/imagenes/logo.png" alt="">
            </figure>

            <div class="container">
                <button class="menu-btn">PROFESOR
                    <img src="/static/imagenes/profesor.png" alt="profesor" id="imagenPrevia">
                </button>
                
                <div class="menu-items">
                    <h6 class="gestion">Gestión perfil</h6>
                    <a href="/alphaTeam/profesor/usuario" >Informacion de Usuario
                        <img src="/static/imagenes/bxs-user-circle.svg" alt="nota">
                    </a>
                    <a href="/alphaTeam/profesor/contraseña">Cambio de contraseña
                        <img src="/static/imagenes/bxs-key1.svg" alt="nota">
                    </a> 
                </div>
            </div>
    </header>
        
    <div class="cout">
        <button class="menu">
            <img src="/static/imagenes/bx-menu.svg" alt="">
        </button>
        <div class="content">
            <ul>
                <li><img src="/static/imagenes/bx-notepad.svg" alt="nota">
                    <a href="/alphaTeam/profesor/calificaciones">CALIFICACIONES
                </a></li>
                <li><img src="/static/imagenes/bxs-graduation.svg" alt="graduacion">
                    <a href="/alphaTeam/profesor/informacion">INFORMACION ESTUDIANTE
                </a></li>
                <li><img src="/static/imagenes/bxs-book-content.svg" alt="evaluar">
                    <a href="/alphaTeam/profesor/planificacion">PLANIFICACION
                </a></li>
                <li><img src="/static/imagenes/bx-help-circle.svg" alt="ayuda">
                    <a href="/alphaTeam/profesor/ayuda">AYUDA
                </a></li>
                <li><img src="/static/imagenes/bx-comment-error.svg" alt="calendario">
                        <a href="/alphaTeam/profesor/reportar">REPORTAR UN PROBLEMA
                    </a></li>
                <li><img src="/static/imagenes/bx-log-out.svg" alt="cerrar">
                    <a href="/alphaTeam/templates/cerrarsesion">CERRAR SESION
                </a></li> 
            </ul>
        </div>
    </div>

    <main>
        <section>
            <div class="calificaciones_docente1">
                <form method="POST" action="/alphaTeam/profesor/calificaciones">
                    <fieldset>
                        <legend>CALIFICACIONES</legend>
                        <label for="cur">Cursos</label>
                        <select name="cur" id="cur" required>
                            <option value="">- Elija un curso - </option>
                            <option value="1ro" {% if selected_curso == '1ro' %}selected{% endif %}>1ro de secundaria</option>
                            <option value="2do" {% if selected_curso == '2do' %}selected{% endif %}>2do de secundaria</option>
                            <option value="3ro" {% if selected_curso == '3ro' %}selected{% endif %}>3ro de secundaria</option>
                            <option value="4to" {% if selected_curso == '4to' %}selected{% endif %}>4to de secundaria</option>
                            <option value="5to" {% if selected_curso == '5to' %}selected{% endif %}>5to de secundaria</option>
                            <option value="6to" {% if selected_curso == '6to' %}selected{% endif %}>6to de secundaria</option>
                        </select>

                        <label for="asig">Materia</label>
                        <select name="asig" id="asig" required>
                            <option value="">- Elija una materia -</option>
                            <option value="1" {% if selected_asignatura == '1' %}selected{% endif %}>Lengua Española</option>
                            <option value="2" {% if selected_asignatura == '2' %}selected{% endif %}>Matemáticas</option>
                            <option value="3" {% if selected_asignatura == '3' %}selected{% endif %}>Ciencias Sociales</option>
                            <option value="4" {% if selected_asignatura == '4' %}selected{% endif %}>Ciencias Naturales</option>
                            <option value="5" {% if selected_asignatura == '5' %}selected{% endif %}>Física</option>
                            <option value="6" {% if selected_asignatura == '6' %}selected{% endif %}>Educación Financiera</option>
                            <option value="7" {% if selected_asignatura == '7' %}selected{% endif %}>Inglés</option>
                        </select>

                        <label for="period">Periodo</label>
                        <select name="period" id="period" required>
                            <option value="">- Elija un periodo -</option>
                            <option value="1" {% if selected_periodo == '1' %}selected{% endif %}>1 Periodo</option>
                            <option value="2" {% if selected_periodo == '2' %}selected{% endif %}>2 Periodo</option>
                            <option value="3" {% if selected_periodo == '3' %}selected{% endif %}>3 Periodo</option>
                            <option value="4" {% if selected_periodo == '4' %}selected{% endif %}>4 Periodo</option>
                            <option value="5" {% if selected_periodo == '5' %}selected{% endif %}>Completivo</option>
                            <option value="6" {% if selected_periodo == '6' %}selected{% endif %}>Extraordinario</option>
                            <option value="7" {% if selected_periodo == '7' %}selected{% endif %}>Final</option>
                        </select>
                        <input type="text" name="buscar" id="buscar" class="buscarb" placeholder="Buscar Estudiante">
                        <input type="submit" name="action" value="CARGAR" class="boton">
                    
                        <br><br>
                    </fieldset>

                    <div class="tabla1">
                        <table border="1">
                            <tr>
                                <th class="complete">NOMBRES</th>
                                <th class="apellido">APELLIDOS</th>
                                <th>ID</th>
                                <th>MATRICULA</th>
                                <th>TAREAS</th>
                                <th>EXAM</th>
                                <th>PART</th>
                                <th>ASIST</th>
                                <th>CALIFICACION</th>
                            </tr>

                            {% for estudiante in estudiantes %}
                            <tr class="busqueda">
                                <td>{{ estudiante[0] }}</td>  
                                <td>{{ estudiante[1] }}</td>
                                <td>{{ estudiante[2] }}</td> 
                                <td>{{ estudiante[3] }}</td>

                                <td><input type="number" name="tareas_{{ estudiante[2] }}_{{ selected_asignatura }}" value="{{ estudiante[4] }}" min="0" max="25" maxlength="3" oninput="validarYCalcular(this, '{{ estudiante[2] }}', '{{ selected_asignatura }}')"></td>
                                <td><input type="number" name="examenes_{{ estudiante[2] }}_{{ selected_asignatura }}" value="{{ estudiante[5] }}" min="0" max="25" maxlength="3" oninput="validarYCalcular(this, '{{ estudiante[2] }}', '{{ selected_asignatura }}')"></td>
                                <td><input type="number" name="participacion_{{ estudiante[2] }}_{{ selected_asignatura }}" value="{{ estudiante[6] }}" min="0" max="25" maxlength="3" oninput="validarYCalcular(this, '{{ estudiante[2] }}', '{{ selected_asignatura }}')"></td>
                                <td><input type="number" name="asistencia_{{ estudiante[2] }}_{{ selected_asignatura }}" value="{{ estudiante[7] }}" min="0" max="25" maxlength="3" oninput="validarYCalcular(this, '{{ estudiante[2] }}', '{{ selected_asignatura }}')"></td>
                                <td><input type="text" name="cali_final_{{ estudiante[2] }}_{{ selected_asignatura }}" value="{{ estudiante[8] }}" maxlength="3" readonly></td>
                                <input type="hidden" name="estudiante_id_{{ estudiante[2] }}" value="{{ estudiante[2] }}">
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                    <input type="submit" name="action" value="Publicar Notas" class="publicar">
                </form>
            </div>

</section>
    </main>

    <script>

        document.getElementById('uploadButton').addEventListener('click', function(event) {
            event.preventDefault();
            const input = document.getElementById('imageInput');
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const base64Image = event.target.result;
                    localStorage.setItem('uploadedImage', base64Image);
                    document.getElementById('imagenPrevia').src = base64Image;
                };
                
                reader.readAsDataURL(file);
            }
        });
        
        // Al cargar la página, verifica si hay una imagen en localStorage y la muestra
        document.addEventListener('DOMContentLoaded', function() {
            const storedImage = localStorage.getItem('uploadedImage');
            if (storedImage) {
                document.getElementById('imagenPrevia').src = storedImage;
            }
        });
        
        // Añade un evento de clic a la imagen de borrar para eliminar la foto
        document.querySelector('.borrar').addEventListener('click', function() {
            localStorage.removeItem('uploadedImage');
            document.getElementById('imagenPrevia').src = '/static/imagenes/usuario.svg';
            alert("Se eliminó la imagen del perfil.")
        });



        document.getElementById('cur').addEventListener('change', function() {
            var cursoId = this.value;
            if (cursoId) {
                fetch('/get_estudiantes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'curso_id=' + encodeURIComponent(cursoId),
                })
                .then(response => response.text())
                .then(html => {
                    document.getElementById('tabla_estudiantes').innerHTML = html;
                })
                .catch(error => console.error('Error al cargar los estudiantes:', error));
            } else {
                document.getElementById('tabla_estudiantes').innerHTML = '';
            }

        });

      
        function validarYCalcular(input, estudianteId, asignaturaId) {
            const max = 25;
            let calificacion = parseInt(input.value);
        
            if (calificacion > max) {
                input.value = max;
                alert("El valor máximo permitido es 25.");
            } else if (calificacion < 0 || isNaN(calificacion)) {
                // isNaN esto es para evitar que se ingresen letras en las tablas
                input.value = 0;
                alert("El valor mínimo permitido es 0.");
            }
        
            calcularCalificacion(estudianteId, asignaturaId);
        }
        
        function calcularCalificacion(estudianteId, asignaturaId) {
            const tareas = parseInt(document.querySelector(`input[name="tareas_${estudianteId}_${asignaturaId}"]`).value) || 0;
            const examenes = parseInt(document.querySelector(`input[name="examenes_${estudianteId}_${asignaturaId}"]`).value) || 0;
            const participacion = parseInt(document.querySelector(`input[name="participacion_${estudianteId}_${asignaturaId}"]`).value) || 0;
            const asistencia = parseInt(document.querySelector(`input[name="asistencia_${estudianteId}_${asignaturaId}"]`).value) || 0;
        
            const cali_final = tareas + examenes + participacion + asistencia;
        
            document.querySelector(`input[name="cali_final_${estudianteId}_${asignaturaId}"]`).value = cali_final;
        }

        
        
    </script>
    <script src="/static/js/busqueda.js"></script>

</body>
</html>